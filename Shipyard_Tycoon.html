<!DOCTYPE html>
<html>
<style>
    td {
            border: 1px solid black;
            padding-left: 12px;
            padding-right: 12px;
        }
    
    ul.tab {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

    /* Float the list items side by side */
    ul.tab li {float: left;}

    /* Style the links inside the list items */
    ul.tab li a {
        display: inline-block;
        color: black;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of links on hover */
    ul.tab li a:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    ul.tab li a:focus, .active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }
    
    #smeltBackground {
        position: relative;
        width: 60px;
        height: 30px;
        background-color: #ddd;
    }

    #smeltBar {
        position: absolute;
        width: 1%;
        height: 100%;
        background-color: #4CAF50;
    }
</style>
<body>
<script>
    var resources = {scrap:{current:3,income:0,price:3,name:"Scrap"},iron:{current:3,income:0,price:5,name:"Iron"},money:{current:0,income:0,price:1,name:"Money"},tinyBulkhead:{name:"Tiny Bulkhead",ingredients:{iron:3},price:23,current:0}}; 
    var smelting = false;
    var resourceMaster = {scrap:resources.scrap, iron:resources.iron, money:resources.scrap,tinyBulkhead:resources.tinyBulkhead};
    function generateResourceTable() {
        var table = "<table>";
        for (var name in resources) {
            table += "<tr>";
            table += "<td id='" + name + "label'>" + resources[name].name + ": " + resources[name].current + "</td>";
            table += "</tr>";
        }
        table += "</table>";
        document.write(table);
    }
    
    function generateMarketTable() {
        var table = "<table>";
        for (var name in resources) {
            table += "<tr>";
            if (name != "money") {
                table += "<td>" + resources[name].name + ": " + resources[name].price + "</td>";
                table += "<td><button type='button' onclick='marketFunction(\"" + name + "\",0)'  class='marketButton'>+</button></td>";
                table += "<td><button type='button' onclick='marketFunction(\"" + name + "\",1)'  class='marketButton'>-</button></td>";
            }
            table += "</tr>";
        }
        table += "</table>";
        document.write(table);
    }
</script>    
    
<div style='float:left'>
<script>generateResourceTable();</script>    
</div> 
    
<ul class="tab">
  <li><a href="javascript:void(0)" class="tablinks" onclick="openTab(event, 'Shipyard')" id="defaultOpen">Shipyard</a></li>
  <li><a href="javascript:void(0)" class="tablinks" onclick="openTab(event, 'Market')">Market</a></li>
  <li><a href="javascript:void(0)" class="tablinks" onclick="openTab(event, 'Upgrades')">Upgrades</a></li>
</ul>      
    
<div id="Shipyard" class="tabcontent" style='float:left'>
    <div id="smeltBackground" onclick='smelt()'>
        <div id="smeltBar">SMELT</div>
    </div>
    <div style='margin-top:10px'><u> Fabrication </u>
        <script>
            var table = "<table>";
            for (var name in resources) {
                if (resources[name].ingredients) {
                    table += "<tr>";
                    table += "<td onclick='fabricateItem(\"tinyBulkhead\")'>" + resources[name].name +"</td>";
                    table += "</tr>";   
                }
            }
            table += "</table>";
            document.write(table);
        </script>
    </div>
</div>

<div id="Market" class="tabcontent" style='float:left'>
    <script>generateMarketTable();</script>
</div>

<div id="Upgrades" class="tabcontent" style='float:left'>
    <u>Upgrades</u>
</div>     
    
<script>
    function smelt(){
        if (resources.scrap.current > 0 && !smelting) {
            move();
            resources.scrap.current -= 1;
            resources.iron.current += 1;
            refreshResource("scrap");
            refreshResource("iron");
        }
    }
    
    function refreshResource(resource){
        document.getElementById(resource+'label').innerHTML = resources[resource].name + ": " + resources[resource].current;
    }
    
    function openTab(evt, tab) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tab).style.display = "block";
        evt.currentTarget.className += " active";
    }

    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();
    
    function move() {
        var elem = document.getElementById("smeltBar");   
        var width = 1;
        var id = setInterval(frame, 10);
        smelting = true;
        
        function frame() {
            if (width >= 100) {
                smelting = false;
                clearInterval(id);
            } else {
                width++;
                elem.style.width = width + '%'; 
            }
        }
    }
    
    function fabricateItem(given) {
        takeIngredients(resources[given].ingredients);
        resources[given].current += 1;
        refreshResource(given);
    }
    
    function takeIngredients(given) {
        var sufficient = true;

        for(var name in given) {
            var value = given[name];
            if (name != "scaling" && given[name] > resources[name].current) {
                sufficient = false;
            }
        }

        if (sufficient) {
            for(var name in given) {
                var value = given[name];
                resources[name].current -= given[name];
                refreshResource(name);
            }   
        }

        else {
            alert("Too Poor!");
        }

        return sufficient;
    }
    
    function marketFunction(given,toggle) {
        if (toggle == 0 && resources.money.current >= resources[given].price) {
            resources.money.current -= resources[given].price;
            resources[given].current += 1;
            refreshResource("money");
            refreshResource(given);
        }
        
        else if (toggle == 1 && resources[given].current > 0) {
            resources.money.current += resources[given].price;
            resources[given].current -= 1;
            refreshResource("money");
            refreshResource(given);
        }
        else {
            alert("Can't do that!");
        }
    }
</script>
<script>
/*First steps:
Resource tab and market tab - DONE
Smelt scrap into iron - DONE
sell iron and buy scrap - DONE
fabricate iron into bulkeads and sell
do multiple smelt/fabricate simulatneously 

Problems:
Smelt bar doesn't start full
Can't see price well
Alert when not enough money to buy is bad
</script>
</body>
</html>
